---
import { getUpcomingEvents } from "../utils/calendar";
import { MapPin, Clock } from "lucide-react";
import { getSiteContent } from "../data/site-content";
import {
  formatEventDayOfMonth,
  formatEventMonthShort,
  formatEventTime,
} from "../utils/calendar";

const events = await getUpcomingEvents(3, true);
const content = await getSiteContent();
const copy = content.components.calendar_events ?? {
  empty_message: "Check out What's On for current activities.",
  view_whats_on_label: "View What's On ->",
};
---

<div class="space-y-4">
  {
    events.length === 0 ? (
      <div class="theme-card p-4 text-(--ink)">
        <p class="font-bold">{copy.empty_message}</p>
      </div>
    ) : (
      events.map((event) => (
        <a
          href={`/events/${event.slug}`}
          class="block theme-card theme-card--interactive theme-card--strong border-[3px] p-6"
        >
          <div class="flex items-start gap-4">
            <div class="bg-(--ink) text-white p-3 flex flex-col items-center justify-center min-w-16">
              <span class="text-xs font-bold uppercase tracking-wider">
                {formatEventMonthShort(event.start, event.timeZone)}
              </span>
              <span class="text-2xl font-black">
                {formatEventDayOfMonth(event.start, event.timeZone)}
              </span>
            </div>
            <div class="flex-1">
              <h3 class="section-heading text-xl uppercase leading-tight mb-2">
                {event.title}
              </h3>
              <div class="flex flex-col gap-1 text-sm font-medium text-(--ink)/80">
                <div class="flex items-center gap-2">
                  <Clock size={16} />
                  <span>{formatEventTime(event.start, event.timeZone)}</span>
                </div>
                {event.location && (
                  <div class="flex items-center gap-2">
                    <MapPin size={16} />
                    <span>{event.location}</span>
                  </div>
                )}
              </div>
            </div>
            {event.thumbnailUrl && (
              <img
                src={event.thumbnailUrl}
                alt={`Thumbnail for ${event.title}`}
                class="hidden sm:block w-28 h-20 object-cover theme-photo"
                loading="lazy"
              />
            )}
          </div>
        </a>
      ))
    )
  }
  <div class="pt-4 text-center">
    <a
      href="/whats-on#upcoming-events"
      class="inline-flex items-center gap-2 font-bold uppercase tracking-wider text-(--ink) hover:text-(--eden) transition-colors border-b-2 border-transparent hover:border-(--eden)"
    >
      {copy.view_whats_on_label}
    </a>
  </div>
</div>
