---
import { getUpcomingEvents } from "../utils/calendar";
import { MapPin, Clock } from "lucide-react";
import {
  formatEventDayOfMonth,
  formatEventMonthShort,
  formatEventTime,
} from "../utils/calendar";

const events = await getUpcomingEvents(3, true);
---

<div class="space-y-4">
  {
    events.length === 0 ? (
      <div class="p-4 bg-white/50 border-[3px] border-(--ink) text-(--ink)">
        <p class="font-bold">Check out What's On for current activities.</p>
      </div>
    ) : (
      events.map((event) => (
        <a
          href={`/events/${event.slug}`}
          class="block bg-white border-[3px] border-(--ink) p-6 shadow-[4px_4px_0px_0px_var(--eden)] hover:shadow-none hover:translate-y-1 transition-all"
        >
          <div class="flex items-start gap-4">
            <div class="bg-(--ink) text-white p-3 flex flex-col items-center justify-center min-w-16">
              <span class="text-xs font-bold uppercase tracking-wider">
                {formatEventMonthShort(event.start, event.timeZone)}
              </span>
              <span class="text-2xl font-black">
                {formatEventDayOfMonth(event.start, event.timeZone)}
              </span>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-bold uppercase text-(--ink) leading-tight mb-2">
                {event.title}
              </h3>
              <div class="flex flex-col gap-1 text-sm font-medium text-(--ink)/80">
                <div class="flex items-center gap-2">
                  <Clock size={16} />
                  <span>{formatEventTime(event.start, event.timeZone)}</span>
                </div>
                {event.location && (
                  <div class="flex items-center gap-2">
                    <MapPin size={16} />
                    <span>{event.location}</span>
                  </div>
                )}
              </div>
            </div>
            {event.thumbnailUrl && (
              <img
                src={event.thumbnailUrl}
                alt={`Thumbnail for ${event.title}`}
                class="hidden sm:block w-28 h-20 object-cover border-2 border-(--ink)"
                loading="lazy"
              />
            )}
          </div>
        </a>
      ))
    )
  }
  <div class="pt-4 text-center">
    <a
      href="/whats-on#upcoming-events"
      class="inline-flex items-center gap-2 font-bold uppercase tracking-wider text-(--ink) hover:text-(--eden) transition-colors border-b-2 border-transparent hover:border-(--eden)"
    >
      View What's On ->
    </a>
  </div>
</div>
