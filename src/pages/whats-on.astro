---
import Layout from "../layouts/Layout.astro";
import { ArrowRight, Calendar, Clock, MapPin } from "lucide-react";
import {
  CALENDAR_URL,
  formatEventDateTimeShort,
  getUpcomingEvents,
} from "../utils/calendar";

const upcomingEvents = await getUpcomingEvents(6);
const webcalUrl = CALENDAR_URL.replace(/^https:/, "webcal:");
---

<Layout title="What's On">
  <div class="max-w-5xl mx-auto px-4 py-20 space-y-10">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1
          class="page-heading page-heading--accent text-5xl md:text-6xl font-bold"
        >
          What's On
        </h1>
        <p class="text-(--ink)/80 mt-2">
          Weekly church life and upcoming events in one place.
        </p>
        <p class="text-(--ink)/80 mt-2">
          Looking for more information? Try
          <a
            href="/what-we-do"
            class="underline decoration-(--eden) underline-offset-4"
          >
            What We Do
          </a>.
        </p>
      </div>
      <div class="flex flex-wrap gap-3">
        <a
          href={webcalUrl}
          class="inline-flex items-center gap-2 px-4 py-2 bg-white text-(--ink) border-2 border-(--ink) hover:bg-(--ink) hover:text-white transition-colors font-semibold"
        >
          <Calendar size={16} /> Import Calendar
        </a>
      </div>
    </div>

    <section id="upcoming-events" class="theme-card p-8 space-y-4">
      <h2 class="section-heading text-3xl mb-1">Upcoming Events</h2>
      <p class="text-(--ink)/90">Pulled from our live church calendar.</p>
      {
        upcomingEvents.length > 0 ? (
          <div class="grid gap-3">
            {upcomingEvents.map((event) => (
              <article class="border-2 border-(--ink) p-4 bg-(--panel-soft)">
                <a
                  href={`/events/${event.slug}`}
                  class="flex items-start gap-4 hover:opacity-80 transition-opacity"
                >
                  <div class="flex-1">
                    <h3 class="text-xl font-bold text-(--ink)">
                      {event.title}
                    </h3>
                    <div class="mt-2 flex flex-col sm:flex-row sm:flex-wrap gap-3 text-(--ink)/85 text-sm font-medium">
                      <span class="inline-flex items-center gap-2">
                        <Clock size={15} />{" "}
                        {formatEventDateTimeShort(event.start, event.timeZone)}
                      </span>
                      {event.location && (
                        <span class="inline-flex items-center gap-2">
                          <MapPin size={15} /> {event.location}
                        </span>
                      )}
                    </div>
                  </div>
                  {event.thumbnailUrl && (
                    <img
                      src={event.thumbnailUrl}
                      alt={`Thumbnail for ${event.title}`}
                      class="w-28 h-20 object-cover border-2 border-(--ink)"
                      loading="lazy"
                    />
                  )}
                </a>
              </article>
            ))}
          </div>
        ) : (
          <p class="text-(--ink)/90">
            No upcoming events found right now. Please check back soon.
          </p>
        )
      }
      <a
        href="#sunday-gathering"
        class="inline-flex items-center gap-2 font-semibold text-(--ink) hover:text-(--eden) transition-colors"
      >
        See regular weekly activities <ArrowRight size={16} />
      </a>
    </section>

    <section id="sunday-gathering" class="theme-card p-8">
      <h2 class="section-heading text-3xl mb-3">Sunday Gathering</h2>
      <p class="text-(--ink)/90">
        Our Sunday gathering happens every Sunday at 10:45am and is for all
        ages. We gather to worship Jesus, hear from God's Word, and pray
        together.
      </p>
      <img
        src="/images/worship team.jpg"
        alt="Worship team leading during the Sunday gathering"
        class="w-full h-72 object-cover border-2 border-(--ink) mt-4"
        loading="lazy"
      />
    </section>

    <section id="midweek-prayers" class="theme-card p-8">
      <h2 class="section-heading text-3xl mb-3">Midweek Online Prayers</h2>
      <p class="text-(--ink)/90">
        Monday to Friday at 8:00am for 30 minutes on Zoom.
      </p>
      <a
        href="https://zoom.us/j/3235649987?pwd=483559"
        class="inline-block bg-(--ink) text-white px-4 py-2 font-bold mb-2 hover:bg-(--eden) transition-colors border-2 border-transparent hover:border-(--ink)"
      >
        Join Zoom Meeting
      </a>
      <p class="text-(--ink)/90 text-sm">
        Meeting ID: <strong>323 564 9987</strong> | Passcode: <strong
          >483559</strong
        >
      </p>
      <p class="text-(--ink)/90">
        We also meet in church on the first Sunday of each month from
        10:00-10:30am before the service.
      </p>
    </section>

    <section id="foodbank" class="theme-card p-8">
      <h2 class="section-heading text-3xl mb-2">Food Bank</h2>
      <p class="text-(--ink)/90">
        <strong>When:</strong> Every Monday 10am - 12pm
      </p>
      <p class="text-(--ink)/90">
        <strong>Where:</strong> St John's Park, Bernard Street, S2 5PU
      </p>
      <p class="text-(--ink)/90 mb-3">
        <strong>Who:</strong> Anyone with a referral from a support worker or agency
      </p>
      <img
        src="/images/foodbank.png"
        alt="Food bank volunteers welcoming people in the church hall"
        class="w-full h-72 object-cover border-2 border-(--ink) mb-4"
        loading="lazy"
      />
      <p class="mb-3 text-(--ink)/90">
        The St John's Park food bank is provided in collaboration with Sheffield
        Food and Community Trust and Trussell.
      </p>
      <p class="mb-3 text-(--ink)/90">
        The food bank is accessible by referral only, and provides an emergency
        parcel for those in food crisis.
      </p>
      <p class="mb-3 text-(--ink)/90">
        At the food bank, we offer support with more than just food; Citizens
        Advice and Debt Support workers are available during the food bank
        session for those with referrals.
      </p>
      <p class="text-(--ink)/90 mb-2">
        To request a referral for a food parcel call either:
      </p>
      <ul class="list-disc pl-6 space-y-1 text-(--ink)/90">
        <li>
          Help Through Hardship: 08082082138 Monday to Friday 9am - 5pm.
          Translators available.
        </li>
        <li>
          Citizens Advice Sheffield: 08082787820 Monday to Friday 10am - 4pm.
          Select option 4 for Advice Line.
        </li>
        <li>Sheffield S6 helpline: 0114 321 0733 Monday to Friday 10am-1pm.</li>
      </ul>
      <p class="mt-3 text-(--ink)/90">
        If you are interested in volunteering at our food bank, please contact
        Hannah Graham for more information: <a
          href="mailto:hannah@saintjohnspark.org"
          class="underline decoration-(--eden) underline-offset-4"
          >hannah@saintjohnspark.org</a
        >
      </p>
    </section>

    <section id="lunch-club" class="theme-card p-8">
      <h2 class="section-heading text-3xl mb-2">Lunch Club</h2>
      <p class="font-semibold text-(--ink) mb-3">Monday 11:40am-12:40pm</p>
      <p class="text-(--ink)/90">
        Join us every Monday for soup, bread, a hot drink, and a chat. All are
        welcome, and it is free.
      </p>
      <img
        src="/images/lunch club.jpg"
        alt="Lunch Club guests and volunteers sharing a meal together"
        class="w-full h-72 object-cover border-2 border-(--ink) mt-4"
        loading="lazy"
      />
    </section>

    <section id="seasonal-events" class="theme-card p-8">
      <h2 class="section-heading text-3xl mb-2">Seasonal Events</h2>
      <p class="text-(--ink)/90 mb-4">
        Throughout the year we host seasonal gatherings for all ages, including
        Christmas events and community celebrations.
      </p>
      <div class="grid md:grid-cols-2 gap-4">
        <img
          src="/images/christmas singing.jpg"
          alt="Christmas singing event in the church hall"
          class="w-full h-64 object-cover border-2 border-(--ink)"
          loading="lazy"
        />
        <img
          src="/images/outdoor carols.jpg"
          alt="Community outdoor carol singing at the church entrance"
          class="w-full h-64 object-cover border-2 border-(--ink)"
          loading="lazy"
        />
      </div>
    </section>
  </div>
</Layout>
