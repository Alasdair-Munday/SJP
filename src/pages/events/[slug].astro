---
import Layout from "../../layouts/Layout.astro";
import { Calendar, Clock, MapPin } from "lucide-react";
import type { CalendarEvent } from "../../utils/calendar";
import { getSiteContent } from "../../data/site-content";
import {
	formatEventDateLong,
	formatEventTime,
	getUpcomingEvents,
} from "../../utils/calendar";

interface Props {
	event: CalendarEvent;
}

export async function getStaticPaths() {
	const events = await getUpcomingEvents(180);

	return events.map((event) => ({
		params: { slug: event.slug },
		props: { event },
	}));
}

const content = await getSiteContent();
const page = content.pages.events;
const { event } = Astro.props as Props;
const descriptionHtml = event.descriptionHtml || page.fallback_description_html;
const location = event.location || page.fallback_location;
---

<Layout title={event.title}>
	<div class="max-w-4xl mx-auto px-4 py-20 space-y-8">
		<a
			href="/whats-on#upcoming-events"
			class="inline-flex items-center gap-2 text-(--ink) font-semibold hover:text-(--eden) transition-colors"
		>
			{page.back_link_label}
		</a>

		<section class="bg-white border-2 border-(--ink) p-8 space-y-8">
			<h1 class="theme-display-font text-4xl md:text-5xl font-bold text-(--ink)">
				{event.title}
			</h1>

			<div class="grid sm:grid-cols-3 gap-4">
				<div class="border-2 border-(--ink) p-4 bg-(--panel-soft)">
					<p class="text-xs uppercase tracking-wide font-bold text-(--ink)/70 mb-1">
						{page.labels.date}
					</p>
					<p class="text-(--ink) font-semibold inline-flex items-center gap-2">
						<Calendar size={16} /> {formatEventDateLong(event.start, event.timeZone)}
					</p>
				</div>
				<div class="border-2 border-(--ink) p-4 bg-(--panel-soft)">
					<p class="text-xs uppercase tracking-wide font-bold text-(--ink)/70 mb-1">
						{page.labels.time}
					</p>
					<p class="text-(--ink) font-semibold inline-flex items-center gap-2">
						<Clock size={16} />
						{formatEventTime(event.start, event.timeZone)} - {formatEventTime(event.end, event.timeZone)}
					</p>
				</div>
				<div class="border-2 border-(--ink) p-4 bg-(--panel-soft)">
					<p class="text-xs uppercase tracking-wide font-bold text-(--ink)/70 mb-1">
						{page.labels.location}
					</p>
					<p class="text-(--ink) font-semibold inline-flex items-center gap-2">
						<MapPin size={16} /> {location}
					</p>
				</div>
			</div>

			<div class="border-t-2 border-(--ink) pt-6">
				<h2 class="text-2xl font-bold text-(--ink) mb-4">{page.about_title}</h2>
				<div
					class="text-(--ink)/90 leading-relaxed [&_h1]:text-3xl [&_h1]:font-bold [&_h1]:text-(--ink) [&_h1]:mb-3 [&_h2]:text-2xl [&_h2]:font-bold [&_h2]:text-(--ink) [&_h2]:mb-3 [&_h3]:text-xl [&_h3]:font-bold [&_h3]:text-(--ink) [&_h3]:mb-2 [&_p]:mb-4 [&_ul]:list-disc [&_ul]:pl-6 [&_ol]:list-decimal [&_ol]:pl-6 [&_li]:mb-1 [&_a]:underline [&_a]:decoration-(--eden) [&_a]:underline-offset-4"
					set:html={descriptionHtml}
				></div>
			</div>

			{
				event.imageAttachments.length > 0 && (
					<div class="border-t-2 border-(--ink) pt-6">
						<h2 class="text-2xl font-bold text-(--ink) mb-4">{page.images_title}</h2>
						<div class="grid sm:grid-cols-2 gap-4">
							{event.imageAttachments.map((image, index) => (
								<a href={image.url} target="_blank" rel="noreferrer" class="block">
									<img
										src={image.url}
										alt={image.fileName || `${page.image_alt_prefix} ${index + 1}`}
										class="w-full h-72 object-cover border-2 border-(--ink)"
										loading="lazy"
									/>
								</a>
							))}
						</div>
					</div>
				)
			}
		</section>
	</div>
</Layout>
